<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOEIC Vocabulary Flashcards</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: #0f172a;
            color: #f8fafc;
            min-height: 100vh;
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-hover:hover {
            transform: translateY(-4px);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
        }

        .gradient-text {
            background: linear-gradient(135deg, #818cf8 0%, #c084fc 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }
    </style>
</head>

<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header Section -->
        <header class="mb-12 text-center">
            <h1 class="text-5xl font-bold mb-4 gradient-text">TOEIC Vocabulary</h1>
            <p class="text-slate-400 text-lg">Master your English with daily flashcards</p>
        </header>

        <!-- Search & Filter Bar -->
        <div
            class="bg-slate-900/80 backdrop-blur-xl border border-white/10 p-6 rounded-2xl mb-12 flex flex-col md:flex-row gap-4 items-center justify-between z-50 shadow-2xl">
            <div class="relative w-full md:w-96">
                <input type="text" id="searchInput" placeholder="Search words or meanings..."
                    class="w-full bg-slate-800/50 border border-slate-700 rounded-xl py-3 px-12 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all text-slate-200">
                <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500" fill="none"
                    stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>

            <div class="flex items-center gap-4 w-full md:w-auto">
                <label for="dayFilter" class="text-slate-400 whitespace-nowrap">Day:</label>
                <select id="dayFilter"
                    class="bg-slate-800/50 border border-slate-700 rounded-xl py-2 px-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all text-slate-200 cursor-pointer w-full md:w-auto">
                    <option value="all">All Days</option>
                </select>
            </div>
        </div>

        <!-- Cards Container -->
        <div id="cardsGrid" class="grid grid-cols-1 gap-6">
            <!-- Cards will be injected here -->
            <div id="loader" class="text-center py-20">
                <div
                    class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-indigo-500 border-t-transparent">
                </div>
                <p class="mt-4 text-slate-400">Loading vocabulary...</p>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-20">
            <svg class="mx-auto h-20 w-20 text-slate-700 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h3 class="text-xl font-medium text-slate-400">No matching vocabulary found</h3>
        </div>
    </div>

    <script>
        // Embedded data as fallback for CORS issues (file:// protocol)
        const EMBEDDED_DATA = [
            {
                "book": "Vocab",
                "day": 1,
                "word": "Service",
                "pronounce": "/ˈsɜːrvɪs/",
                "vi": "(n) dịch vụ, sự phục vụ, bảo trì và sửa chữa sau bán hàng\n(v) bảo trì, bảo dưỡng, phục vụ",
                "ex": "This service is free of charge. \n Dịch vụ này hoàn toàn miễn phí. \n Customer service is our top priority. \n Dịch vụ khách hàng là ưu tiên hàng đầu của chúng tôi."
            },
            {
                "book": "Vocab",
                "day": 1,
                "word": "Product",
                "pronounce": "/ˈprɑːdʌkt/",
                "vi": "(n) Sản phẩm, vật phẩm, kết quả",
                "ex": "The new product will be launched next month. \n Sản phẩm mới sẽ được ra mắt vào tháng tới. \n We guarantee the quality of our products. \n Chúng tôi đảm bảo chất lượng của các sản phẩm của mình."
            },
            {
                "book": "Vocab",
                "day": 2,
                "word": "Contract",
                "pronounce": "/ˈkɑːntrækt/",
                "vi": "(n) Hợp đồng, giao kèo\n(v) ký kết, thầu, nhiễm (bệnh)",
                "ex": "Please read the contract carefully before signing. \n Vui lòng đọc kỹ hợp đồng trước khi ký. \n They have just signed a multi-million dollar contract. \n Họ vừa mới ký một hợp đồng trị giá hàng triệu đô la."
            },
            {
                "book": "Vocab",
                "day": 2,
                "word": "Requirement",
                "pronounce": "/rɪˈkwaɪərmənt/",
                "vi": "(n) Yêu cầu, sự đòi hỏi, điều kiện tiên quyết",
                "ex": "Candidates must meet all the requirements. \n Ứng viên phải đáp ứng tất cả các yêu cầu. \n Experience is a basic requirement for this job. \n Kinh nghiệm là một yêu cầu cơ bản cho công việc này."
            }
        ];

        // Robust Audio Player with Fallback to Browser Speech Synthesis
        window.playAudio = function (text, url) {
            if (!text) return;

            console.log('Loading audio for:', text);

            // Stop any current speech
            if (window.speechSynthesis) window.speechSynthesis.cancel();

            // Create a temporary audio element for the external service
            const audioLink = url || `https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(text)}&type=2`;
            const audio = new Audio(audioLink);

            const playPromise = audio.play();

            if (playPromise !== undefined) {
                playPromise
                    .then(() => {
                        console.log('Playing via external service');
                    })
                    .catch(error => {
                        console.warn('Network audio failed/blocked, using Web Speech API fallback:', error);
                        fallbackToWebSpeech(text);
                    });
            } else {
                fallbackToWebSpeech(text);
            }
        };

        function fallbackToWebSpeech(text) {
            if (!('speechSynthesis' in window)) return;
            const utterance = new SpeechSynthesisUtterance(text);
            const isVietnamese = /[àáạảãâầấậẩẫăằắặẳẵèéẹẻẽêềếệểễìíịỉĩòóọỏõôồốộổỗơờớợởỡùúụủũưừứựửữỳýỵỷỹđ]/i.test(text);
            utterance.lang = isVietnamese ? 'vi-VN' : 'en-US';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }

        window.playSequence = function (text) {
            if (!text || !('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            const lines = text.split('\n').map(l => l.trim()).filter(l => l);
            let index = 0;
            function playNext() {
                if (index >= lines.length) return;
                const line = lines[index++];
                const utterance = new SpeechSynthesisUtterance(line);
                const isVietnamese = /[àáạảãâầấậẩẫăằắặẳẵèéẹẻẽêềếệểễìíịỉĩòóọỏõôồốộổỗơờớợởỡùúụủũưừứựửữỳýỵỷỹđ]/i.test(line);
                utterance.lang = isVietnamese ? 'vi-VN' : 'en-US';
                utterance.rate = 1.25;
                utterance.onend = () => setTimeout(playNext, 400);
                window.speechSynthesis.speak(utterance);
            }
            playNext();
        };

        let vocabData = [];
        const cardsGrid = document.getElementById('cardsGrid');
        const searchInput = document.getElementById('searchInput');
        const dayFilter = document.getElementById('dayFilter');
        const emptyState = document.getElementById('emptyState');

        // Fetch data from JSON
        async function loadVocabulary() {
            try {
                // Try to fetch newest data if running on a server
                const response = await fetch('../documents/TOEIC/vocabulary.json');
                if (!response.ok) throw new Error('Fetch failed');
                vocabData = await response.json();
                console.log('Using data from JSON file');
            } catch (error) {
                console.warn('Could not fetch JSON (likely CORS or file not found). Using embedded data.', error);
                vocabData = EMBEDDED_DATA;
            } finally {
                initFilters();
                renderCards(vocabData);
            }
        }

        function initFilters() {
            const days = [...new Set(vocabData.map(item => item.day))].sort((a, b) => a - b);
            days.forEach(day => {
                const option = document.createElement('option');
                option.value = day;
                option.textContent = `Day ${day}`;
                dayFilter.appendChild(option);
            });
        }

        function formatExample(ex) {
            if (!ex) return '';
            return ex.split('\n').map(line => {
                const text = line.trim();
                if (!text) return '';
                const isVietnamese = /[àáạảãâầấậẩẫăằắặẳẵèéẹẻẽêềếệểễìíịỉĩòóọỏõôồốộổỗơờớợởỡùúụủũưừứựửữỳýỵỷỹđ]/i.test(text);
                // Increased text sizes: text-xl for English and text-base for Vietnamese
                return `<p class="${isVietnamese ? 'text-indigo-300/60 text-base' : 'text-slate-200 text-xl font-medium'} mb-3 leading-relaxed">${text}</p>`;
            }).join('');
        }

        function renderCards(data) {
            cardsGrid.innerHTML = '';

            if (data.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');

            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'glass rounded-3xl overflow-hidden card-hover transition-all duration-300';

                card.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2">
                        <!-- Left Block: Word & Meaning -->
                        <div class="p-8 border-b md:border-b-0 md:border-r border-slate-700/50 bg-indigo-500/5">
                            <div class="flex items-center gap-2 mb-4">
                                <span class="px-3 py-1 bg-indigo-500/10 text-indigo-400 rounded-full text-xs font-semibold uppercase tracking-wider">
                                    Day ${item.day}
                                </span>
                                <span class="px-3 py-1 bg-slate-700/50 text-slate-400 rounded-full text-xs font-semibold uppercase tracking-wider">
                                    ${item.book || 'TOEIC'}
                                </span>
                            </div>
                            <h2 class="text-4xl md:text-5xl font-bold mb-2 gradient-text">${item.word}</h2>
                            
                            <div class="flex items-center gap-4 mb-4">
                                <p class="text-indigo-400/80 font-mono text-lg">${item.pronounce || ''}</p>
                                <button onclick="window.playAudio('${item.word.replace(/'/g, "\\'")}')" class="p-1.5 rounded-full bg-indigo-500/10 text-indigo-400 hover:bg-indigo-500/20 transition-all active:scale-90 border border-indigo-500/20" title="Play Word">
                                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M8 5v14l11-7z"/>
                                    </svg>
                                </button>
                            </div>

                            <div class="mt-4">
                                <p class="vi-meaning text-base text-indigo-300/90 font-medium whitespace-pre-line leading-relaxed">${item.vi}</p>
                            </div>
                        </div>
                        
                        <!-- Right Block: Examples -->
                        <div class="p-8 bg-slate-800/20 flex flex-col">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-widest">Examples & Usage</h3>
                                <button onclick="window.playSequence('${(item.ex || '').replace(/'/g, "\\'").replace(/\n/g, "\\n")}')" 
                                    class="p-2 rounded-full bg-indigo-500/10 text-indigo-400 hover:bg-indigo-500/20 transition-all active:scale-95" title="Listen All">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M8 5v14l11-7z"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-1">
                                ${formatExample(item.ex)}
                            </div>
                        </div>
                    </div>
                `;
                cardsGrid.appendChild(card);
            });
        }

        function handleFilters() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedDay = dayFilter.value;

            const filtered = vocabData.filter(item => {
                const matchesSearch =
                    item.word.toLowerCase().includes(searchTerm) ||
                    item.vi.toLowerCase().includes(searchTerm) ||
                    (item.ex && item.ex.toLowerCase().includes(searchTerm));

                const matchesDay = selectedDay === 'all' || item.day.toString() === selectedDay;

                return matchesSearch && matchesDay;
            });

            renderCards(filtered);
        }

        searchInput.addEventListener('input', handleFilters);
        dayFilter.addEventListener('change', handleFilters);

        // Run on load
        loadVocabulary();
    </script>
</body>

</html>